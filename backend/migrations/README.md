# PartnerForge Database Migrations

This directory contains Alembic database migrations for PartnerForge.

## Directory Structure

```
migrations/
    env.py           # Alembic environment configuration
    script.py.mako   # Migration script template
    versions/        # Individual migration scripts
        001_initial_schema.py
        ...
```

## Commands

```bash
# Apply all pending migrations
alembic upgrade head

# Rollback one migration
alembic downgrade -1

# Rollback to specific revision
alembic downgrade <revision>

# Show current revision
alembic current

# Show migration history
alembic history

# Generate new migration (autogenerate)
alembic revision --autogenerate -m "Description of changes"

# Generate empty migration
alembic revision -m "Description of changes"

# Show SQL without applying
alembic upgrade head --sql
```

## Configuration

The database URL is loaded from:
1. `DATABASE_URL` environment variable (preferred)
2. `sqlalchemy.url` in `alembic.ini`
3. Default: `sqlite+aiosqlite:///data/partnerforge.db`

## Adding New Migrations

1. Make changes to models in `app/models/`
2. Run autogenerate: `alembic revision --autogenerate -m "Add feature X"`
3. Review generated migration in `versions/`
4. Apply: `alembic upgrade head`

## Migration Best Practices

- Always review autogenerated migrations
- Test migrations on a copy of production data
- Include both upgrade() and downgrade() functions
- Use batch_alter_table for SQLite compatibility
- Keep migrations atomic (one logical change per migration)

## Async Support

This configuration uses async SQLAlchemy with:
- `postgresql+asyncpg://` for PostgreSQL
- `sqlite+aiosqlite://` for SQLite

The env.py automatically converts sync URLs to async format.
